# Implementation Plan v1.5 — 2026-01-30

## Общая стратегия
Добавить статус "thinking" для участников, которые взаимодействуют с таблицей гида, чтобы разделить процесс обдумывания и финального голосования. Это предотвратит преждевременное раскрытие оценок и путаницу среди участников.

## Пошаговый чек-лист

### Phase 1: Data Model & API ✅
- [x] **Шаг 1:** В `lib/types.ts` добавить поле `status?: 'voted' | 'thinking'` в интерфейс `Participant`.
- [x] **Шаг 2:** В `app/api/room/[id]/vote/route.ts` обновить логику:
    - Разрешить `vote: null` для сброса (исправлен баг с проверкой `!vote`).
    - Принимать `status` из тела запроса и сохранять его в объект участника.
    - По умолчанию проставлять `voted`, если статус не передан.

### Phase 2: Frontend Logic ✅
- [x] **Шаг 1:** В `app/room/[id]/page.tsx` обновить `handleVote`:
    - Добавить второй аргумент `status` (по умолчанию `voted`).
    - Использовать этот статус при отправке запроса на сервер.
- [x] **Шаг 2:** Обновить вызовы `handleVote`:
    - В `VotingGuide` (через `onVote`) передавать статус `thinking`.
    - При клике на `PokerCard` передавать статус `voted`.
- [x] **Шаг 3:** Добавить кнопку "Confirm" в `components/voting-guide.tsx`:
    - Кнопка появляется, когда есть `Suggested SP`.
    - При клике вызывает `onVote(value, 'voted')`.

### Phase 3: UI Feedback ✅
- [x] **Шаг 1:** В `components/participant-list.tsx` обновить отображение статуса:
    - Если `status === 'thinking'`, показывать иконку песочных часов ⏳.
    - Если `status === 'voted'` (или статус отсутствует, но есть голос), показывать зеленую галочку ✅.
- [x] **Шаг 2:** Проверить, что при `revealed: true` статус `thinking` не мешает отображению финального балла (логика корректна).

## Критические моменты
- **Обратная совместимость:** Нужно убедиться, что старые участники (у которых нет поля `status`) по-прежнему отображаются с галочкой, если у них есть голос.
- **Optimistic UI:** Убедиться, что при переходе из `thinking` в `voted` UI обновляется мгновенно.

## Testing checklist
- [ ] Выбрать значение в таблице Guide -> у других участников появилась иконка ⏳.
- [ ] Нажать "Confirm" в Guide -> иконка сменилась на ✅.
- [ ] Кликнуть по карте в "Your estimate" -> сразу появилась иконка ✅.
- [ ] Нажать "Show estimates" -> все баллы открылись корректно.
- [ ] Повторный клик по карте (снятие голоса) -> иконка исчезла.
